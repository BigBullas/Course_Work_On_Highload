#  Pinterest
### Course Work On Highload

## 1. Тема и целевая аудитория
**Pinterest** - фотохостинг, позволяющий пользователям добавлять в режиме онлайн изображения, помещать их в тематические коллекции и делиться ими с другими пользователями

### MVP

- Регистрация/авторизация
- Просмотр пинов
- Комментирование пинов
- Добавление реакции на пин
- Создание пинов
- Создание собственных досок и сохранение в них пинов

### Целевая аудитория
MAU составляет 450M/ Весь мир

#### Лучшие страны мира по количеству пользователей Pinterest по состоянию на 2023 год

| **Страна** | **Количество, млн** |
|------------|---------------------|
| USA        | 84.6                |
| Brazil     | 28.05               |
| Mexico     | 19.45               |
| Germany    | 15.88               |
| France     | 10.65               |
| Canada     | 8.44                |

Что касается целевой аудитории:
- 55% пользователей составляют люди в возрасте от 18 до 34 лет;
- Количество пользователей от 35 до 54 лет — 31%, а 55 лет и старше — 12%;
- Около 70% всех пользователей — женского пола, мужчины используют социальную сеть намного реже (24%);

### Источники:
- https://www.demandsage.com/pinterest-statistics/
- https://tengyart.ru/statistika-pinterest-v-2020-informacziya-o-auditorii/?ysclid=lmf3csx7nl463560350

## 2. Расчёт нагрузки

### Продуктовые метрики

- Месячная аудитория 450 млн
- Дневная аудитория 225 млн
- Средний размер хранилища пользователя:  
  
Так как Pinterest не предоставляет никакой информации о количестве пинов у одного пользователя,
то возьмём, что в среднем у одного пользователя их 50 штук.  
Пины это файлы в формате .jpg или .mp4, то есть видео и изображения.  
Максимальный размер последних Pinterest установил 20 Mb, то есть будем считать, что в среднем изображение будет весить 10 Mb.  
Видео же должны быть размером меньше 100 Mb, то есть в среднем будут весить 50 Mb.  
На основе информации с данного сайта https://buffer.com/resources/pinterest-marketing-study/ видно, что 99% пинов
это изображения и всего лишь 1% видео.  
Тогда средний размер хранилища пользователя:

```azure
49 * 10 Mb + 1 * 50 Mb = 540 Mb
```

- Среднее количество действий пользователей по типам в день:  
  
С 2022 по 2023 года аудитория Pinterest возросла на 17 млн, то есть в день в среднем регистрировались 46,6 тысяч раз.
Авторизацию же проходят в среднем 4 раза в год, поэтому в день авторизацию проходят в среднем примерно 2,5 млн раз.  
Если взять в расчёт, что один пользователь в среднем смотрит около 50 пинов, то выходит, что в день просматривают
пины около 11 млрд раз.  
Один пользователь комментируют обычно 3 пина в день, тогда комментируют в день 675 млн раз в целом.  
Реакции ставят чаще, около 10 в день, следовательно их добавляют на пины в день около 2 млрд раз.  
Что касается создания пинов, то рядовой пользователь делает это крайне редко,
этим чаще всего занимаются различные юридические лица. Поэтому будем считать, что в день это совершается всего 0,5 раз, 
отсюда получаем, что в день создают пины 112,5 млн раз.  
Создание досок у обычного пользователя происходит в среднем 1 раз в месяц, поэтому в целом 7,5 млн раз.
Что не скажешь о добавлении пинов, в среднем пользователь может сохранить около 5 пинов в день,
то есть в итоге получим около 1 млрд раз.  

| **Действие**          | **Среднее количество в день, штук** |
|-----------------------|-------------------------------------|
| Регистрация           | 46.6 тысяч                          |
| Авторизация           | 2.5 млн                             |
| Просмотр пинов        | 11 млрд                             |
| Комментирование пинов | 675 млн                             |
| Добавление реакции    | 2 млрд                              |
| Создание пина         | 112.5 млн                           |
| Создание досок        | 7.5 млн                             |
| Сохранение пинов      | 1 млрд                              |

### Технические метрики

#### Хранилище

- Регистрация  
  
Здесь основную часть будут занимать аватарки пользователей, средний вес которой равен 5 Мб
За всё время (2009 - 2023): 450 млн пользователей * 5 Мб = 2 146 Тб = 2 Пб  
За год: 2 146 Тб / 14 лет = 153 Тб  
За квартал: 38 Тб  

- Создание пина  
  
Судя по данному источнику
https://aliexpress.inform.click/10-statisticheskih-dannyh-pinterest-kotorye-dolzhen-znat-kazhdyj-marketolog-v-2021-godu-infografika/
в 2019 году у Pinterest было всего около 200 млрд пинов.  
Информацию о том, сколько пинов в среднем добавляет 1 пользователь нет, поэтому возьмём рекомендацию о том, что в среднем
стоит добавлять новых пинов от 1 до 5 пинов (в среднем 3 пина), из источника:
https://www.affde.com/ru/how-many-pinterest-pins-should-i-pin-per-day.html  
Из источника https://www.demandsage.com/pinterest-statistics/ видно, что активных пользователей с 2019 года по 2023 в среднем
было 450 млн, но учитывать будем именно дневную активную аудиторию 225 млн. Тогда с 2019 по 2023 новых пинов примерно появилось:

```azure
4 года * 365 дней * 3 пина * 225 000 000 пользователей = 985,5 млрд пинов
```  

То есть итого сейчас у Pinterest около 1,2 триллиона пинов.  
Как писалось выше, 99% из них это изображения. Отсюда:  
За всё время:  
- Изображения: 1.2 трлн * 0.99 * 10 Mb = 11 064 Пб = 10 Еб (10 эксабайт)
- Видео: 1.2 трлн * 0.01 * 50 Mb = 560 Пб (560 петабайт)
- Итого: 11 564 Пб  
  
За год: 826 Пб  
За квартал: 206.5 Пб  

- Создание комментария 
  
Максимальная длина комментария - 500 символов Unicode, то есть в среднем пусть длина комментария будет 250 символов.
Тогда 1 комментарий будет занимать 500 байт. В день комментируют 675 млн раз. Тогда:  
За квартал: 500 байт * 675 млн * 90 дней = 27 Тб  
За год: 110.5 Тб  
За всё время: 1547 Тб  

Из незначительных по объёму хранилища
- Создание досок: название доски может содержать 50 символов (взято из валидации инпут поля при создании доски),
то есть одна доска будет занимать в среднем 25 * 2 байта = 50 байт
- Добавление реакции на пин: хранить нужно счётчик, id пина, id самой реакции, id статичной картинки реакции
(8 байт + 16 байт + 16 байт + 16 байт = 56 байт)

| **Действие**          | **Объём памяти за всё время** | **Объём памяти за год** | **Объём памяти за квартал** |
|-----------------------|-------------------------------|-------------------------|-----------------------------|
| Регистрация           | 2 Пб                          | 153 Тб                  | 38 Тб                       |
| Комментирование пинов | 1 547 Тб                      | 110.5 Тб                | 27 Тб                       |
| Создание пина         | 11 564 Пб                     | 826 Пб                  | 206.5 Пб                    |

#### Сетевой трафик и rps

Сводная таблица RPS по типовым действиям, средний и пиковый трафики

| **Действие**          | **Тип** | **RPS**  | **RPD**    | **Средний трафик** | **Пиковый трафик** |
|-----------------------|---------|----------|------------|--------------------|--------------------|
| Регистрация           | Запись  | 0.54     | 46.6 тысяч | 2.7 Мб/с           | 4.59 Мб/с          |
| Авторизация           | Чтение  | 3 тыс    | 2.5 млн    | 146.5 Мб/с         | 249 Мб/с           |
| Просмотр пинов        | Чтение  | 127 тыс  | 11 млрд    | 1.2 Тб/с           | 2 Тб/с             |
| Комментирование пинов | Запись  | 8 тыс    | 675 млн    | 3.8 Мб/с           | 6.5 Мб/с           |
| Добавление реакции    | Запись  | 23 тыс   | 2 млрд     | 1.2 Мб/с           | 2.1 Мб/с           |
| Создание пина         | Запись  | 1 тыс    | 112.5 млн  | 9.8 Гб/с           | 16.6 Гб/с          |
| Создание досок        | Запись  | 86       | 7.5 млн    | 4.2 Кб/с           | 7.1 Кб/с           |
| Сохранение пинов      | Запись  | 11.6 тыс | 1 млрд     | 113 Гб/с           | 192.6 Гб/с         |

Пояснение для таблицы:
- RPD взято из пункта выше Среднее количество действий пользователей по типам в день
- RPS = RPD / 86400. Здесь 86400 = 24 часа * 60 минут * 60 секунд
- Средний трафик = RPS * <Вес сообщения из пункта выше Хранилище>
- Пиковый трафик = <Средний трафик> * <Коэффициент отношения пикового трафика к среднему = 1.7>  

## 3. Глобальная балансировка нагрузки

### Расположение датацентров

Из источника https://www.demandsage.com/pinterest-statistics/ ясно, что основные пользователи Pinterest находятся
в таких регионах, таких как Северная Америка, Европа и Азия.  
Поэтому датацентры Pinterest будут в: Сан-Франциско, Нью-Йорк (как одни из крупнейших городов США), Лондон (является ключевым городом в Европе), 
Сингапур (как центральный пункт Азиатско-Тихоокеанского региона), Токио (является одним из крупнейших городов мира и технологическим центром)

### Глобальная балансировка

Балансировка нагрузки будет осуществляться следующим образом:  
**GeoDNS**: для определения местоположения клиента на основе его географических данных,
что позволяет направить его к наиболее близкому серверному центру в соответствующем регионе.  

**BGP Anycast**: для определения ближайшего серверного центра в данном регионе,
что обеспечивает эффективное распределение нагрузки.